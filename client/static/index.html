<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <title>Focus Stacking Interface</title>

    <link href="dependencies/bootstrap-3.3.6-dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="customization.css" rel="stylesheet">
    
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
            <a href="#" class="navbar-brand" data-toggle="modal" data-target="#information_modal" onclick="$('#information_modal').show();">Focus Stacking</a>
        </div>

        <ul class="nav navbar-nav">
            <!-- <li><a href="#" id="navbar_status">Status</a></li> -->
            <li><a href="#" data-toggle="modal" data-target="#settings_modal" onclick="$('#settings_modal').show();">Settings</a></li>
            <li><a href="#" data-toggle="modal" data-target="#preset_modal" onclick="$('#preset_modal').show();">Presets</a></li>
        </ul>

        <ul class="nav navbar-nav navbar-right">
            <li class="dropdown" id="navbar_port_dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown" id="navbar_port_click">Choose serial port<b class="caret"></b></a>
                <ul class="dropdown-menu">
                </ul>
            </li>
        </ul>
      </div>
    </nav>



    <div class="container">



        <div class="modal fade" tabindex="-1" role="dialog" id="preset_modal">
          <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Presets</h4>
                </div>
                <div class="modal-body">

                    <div class="row">
                        <div class="col-lg-6">
                            <div class="list-group" id="preset_list">
                                <button type="button" class="list-group-item">-</button>
                            </div>
                        </div><!-- /.col-lg-6 -->

                        <div class="col-lg-6">

                            <div class="form-group">

                                <div class="panel panel-default">
                                    <div class="panel-heading"><span id="preset_information_heading">Information on Preset</span><a href="#" class="btn-toolbar pull-right" role="button" id="preset_del">delete <span class="glyphicon glyphicon-remove"></span></a></div>
                                    <div class="panel-body">
                                    <table class="table">
                                    <thead>
                                        <tr> <th>Key</th> <th>Value</th></tr>
                                    </thead> 
                                    <tbody id="preset_information">            
                                    </tbody>
                                    </table>

    

                                        <div class="input-group" style="width:100%">
                                            <button class="btn btn-default btn-block" role="button" id="preset_load"><span class="glyphicon glyphicon-save"></span> Load</button>
                                        </div>
                                    </div> <!-- / panel body -->
                                </div> <!-- / panel  -->

                                <div class="input-group has-success" id="preset_name">
                                    <span class="input-group-addon">name</span>
                                    <input type="text" class="form-control" >
                                    <span class="input-group-btn">
                                        <button class="btn btn-default" type="button" id="preset_name_save"><span class="glyphicon glyphicon-open"></span> Save</button>
                                    </span>
                                </div>

                            </div>
                        </div><!-- /.col-lg-6 -->
                    </div><!-- /.row -->
                </div> <!-- modal body -->
            </div>
          </div>
        </div>

        <div class="modal fade" tabindex="-1" role="dialog" id="information_modal">
          <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Information</h4>
                </div>
                <div class="modal-body">
                    <p>
                        The newest source code of this project is available here: <a href="https://github.com/iwanders/focus_stacking">https://github.com/iwanders/focus_stacking</a>.
                    </p>
                    <p>
                        Running firmware version: <span id="firmware_version">unknown</span>
                    </p>
                </div> <!-- modal body -->
            </div>
          </div>
        </div>

        <div class="modal fade" tabindex="-1" role="dialog" id="settings_modal">
          <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Settings</h4>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs" role="tablist" id="settings_tabs">
                        <li role="presentation" class="active"><a href="#interface_settings" aria-controls="interface_settings"  role="tab" data-toggle="tab">Interface</a></li>
                        <li role="presentation"><a href="#motor_settings" aria-controls="motor_settings"  role="tab" data-toggle="tab">Motor</a></li>
                        <li role="presentation"><a href="#camera_settings" aria-controls="camera_settings"  role="tab" data-toggle="tab">Camera</a></li>
                        <!--<li role="presentation"><a href="#settings"  role="tab" data-toggle="tab">Settings</a></li>-->
                    </ul>


                    <div class="tab-content">
                        <p></p>

                        <div role="tabpanel" class="tab-pane active" id="interface_settings">
                            <div class="panel panel-default">
                                <div class="panel-heading">Transmission ratio</div>
                                <div class="panel-body">
                                    <div class="form-group">
                                        <p class="setting_description">
                                            In this interface the motor movements are expressed in degrees. The motor and firmware uses the number of steps made by the stepper driver. This parameter sets the conversion ratio between the two. If the number of steps per revolution is 1600, the transmission ratio to be used will be 1600 / 360 = 4.444. A negative ratio can be used to reverse the direction.
                                            <div class="input-group">
                                                <span class="input-group-addon">transmission_ratio</span>
                                                <input type="number" class="form-control" id="interface_setting_transmission_ratio" min="0" />
                                                <span class="input-group-addon">steps / degree</span>
                                            </div>
                                        </p>
                                    </div>
                                </div>
                            </div><!-- end panel -->

                            <div class="panel panel-default">
                                <div class="panel-heading">Status interval</div>
                                <div class="panel-body">
                                    <div class="form-group">
                                        <p class="setting_description">
                                            The interval by which the firmware sends status messages which provide feedback on what the system is doing.
                                            <div class="input-group" id="interface_status_interval">
                                                <span class="input-group-addon">status_interval</span>
                                                <input type="number" class="form-control" min="10" />
                                                <span class="input-group-addon">ms</span>
                                            </div>
                                        </p>
                                    </div>
                                </div>
                            </div><!-- end panel -->

                            <div class="panel panel-default">
                                <div class="panel-heading">Buzzer</div>
                                <div class="panel-body">
                                    <p>
                                        The buzzer can be used to create an audible notification when the stack sequence has been finished.
                                    </p>

                                    <div class="form-group">
                                        <p class="setting_description">
                                            This setting determines the frequency of the tone emitted by the buzzer in Hertz.
                                            <div class="input-group" id="interface_buzzer_frequency">
                                                <span class="input-group-addon">buzzer_frequency</span>
                                                <input type="number" class="form-control"   min="0" max="65535" />
                                                <span class="input-group-addon">Hz</span>
                                            </div>
                                        </p>
                                        <p class="setting_description">
                                            This setting determines the duration of the tone emitted by the buzzer in milliseconds. The tone can be disabled by setting the duration to zero.
                                            <div class="input-group"  id="interface_buzzer_duration">
                                                <span class="input-group-addon">buzzer_duration</span>
                                                <input type="number" class="form-control" min="0" max="65535"/>
                                                <span class="input-group-addon">ms</span>
                                            </div>
                                        </p>

                                    </div>

                                </div>
                            </div><!-- end panel -->
                        </div>

                        <div role="tabpanel" class="tab-pane" id="motor_settings">
                            <div class="panel panel-default">
                                <div class="panel-heading">Motor</div>
                                <div class="panel-body">
                                    <!-- <p>Configures the motor parameters.</p> -->

                                    <div class="form-group">
                                        <p class="setting_description">
                                            The motor min_width field determines the minimum duration between step pulses. If this value is lower, the maximum speed of the motor will be higher.
                                            <div class="input-group" id="motor_min_width">
                                                <span class="input-group-addon">min_width</span>
                                                <input type="number" class="form-control"  min="0" />
                                                <span class="input-group-addon">us</span>
                                            </div>
                                        </p>
                                        <p class="setting_description">
                                            The motor max_width field determines the maximum duration between step pulses. If this value is higher, the motor will start at a slower speed.
                                            <div class="input-group"  id="motor_max_width">
                                                <span class="input-group-addon">max_width</span>
                                                <input type="number" class="form-control" min="0" />
                                                <span class="input-group-addon">us</span>
                                            </div>
                                        </p>

                                        <p class="setting_description">
                                            The motor ramps up the speed by using a linear profile to change the duration between the step pulses from max_width to min_width. The ramp_length parameter determines how many steps are taken to make this transition.
                                            <div class="input-group" id="motor_ramp_length">
                                                <span class="input-group-addon">ramp_length</span>
                                                <input type="number" class="form-control" min="0" />
                                                <span class="input-group-addon">steps</span>
                                            </div>
                                        </p>
                                    </div>
                                    <p>
                                                
                                        <div class="input-group">
                                            <!--<span class="input-group-btn">
                                                <a href="#" class="btn btn-warning" role="button" id="motor_config_upload">Upload</a>
                                            </span>-->

                                            <input type="number" class="form-control" value="1000" id="motor_config_move_steps" />
                                            <span class="input-group-addon">steps</span>
                                            <span class="input-group-btn">
                                                <button class="btn btn-default" type="button" id="motor_config_move">Move motor</button>
                                            </span>
                                        </div>
                                    </p>
                                </div>
                            </div> <!-- end panel -->
                            
                        </div>

                        <div role="tabpanel" class="tab-pane" id="camera_settings">
                            <div class="panel panel-default">
                                <div class="panel-heading">Camera</div>
                                <div class="panel-body">

                                    <div class="form-group">
                                        <p class="setting_description">
                                            When a photo is to be made, the trigger button is first 'pressed' to the focus stage for a duration of focus_duration.
                                            <div class="input-group" id="camera_focus_duration">
                                                <span class="input-group-addon">focus_duration</span>
                                                <input type="number" class="form-control" min="0" />
                                                <span class="input-group-addon">ms</span>
                                            </div>
                                        </p>
                                        <p class="setting_description">
                                            After the trigger button has been held at the focus stage, the button the 'shutter' stage of the button is kept pressed for the shutter_duration.
                                            <div class="input-group" id="camera_shutter_duration">
                                                <span class="input-group-addon">shutter_duration</span>
                                                <input type="number" class="form-control" min="0" />
                                                <span class="input-group-addon">ms</span>
                                            </div>
                                        </p>

                                    </div>
                                    <p>

                                        <div class="input-group">
                                            <!--<a href="#" class="btn btn-warning" role="button" id="camera_config_upload">Upload</a>-->
                                            <button id="test_camera" type="button" class="btn btn-default pull-right">
                                              <span class="glyphicon glyphicon-camera"></span> Take Photo
                                            </button>
                                        </div>
                                    </p>
                                </div>
                            </div> <!-- end panel -->
                        </div>

                    </div> <!-- tab content-->

                </div> <!-- modal body -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <!-- <button type="button" class="btn btn-primary">Upload</button> -->
                </div>
            </div><!-- /.modal-content -->
          </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->


        <div id="no_websocket_error" class="alert alert-danger" role="alert" style="display: none;">
            <span class="glyphicon glyphicon-exclamation-sign"></span>
            <span class="sr-only">Error:</span>
            Could not connect to the websocket... Did the server crash?
        </div>


        <div id="no_serial_error" class="alert alert-danger" role="alert" style="display: none;">
            <span class="glyphicon glyphicon-exclamation-sign"></span>
            <span class="sr-only">Error:</span>
        </div>

        <div id="no_version_response" class="alert alert-danger" role="alert" style="display: none;">
            <span class="glyphicon glyphicon-exclamation-sign"></span>
            <span class="sr-only">Error:</span>
            The firmware version is being retrieved... If you have long enough to read this, you likely have the wrong serial port.
        </div>

        <div class="panel panel-default">
            <div class="panel-heading">Stack Main Parameters</div>
            <div class="panel-body">
                <div class="form-group">


                        <div class="row">
                            <div class="col-lg-6">
                                <p class="setting_description">
                                    The number of photos to take.
                                </p>
                                <div class="input-group" id="stack_count">
                                    <span class="input-group-addon">stack_count</span>
                                    <input type="number" class="form-control"  min="0" />
                                    <span class="input-group-addon">#</span>
                                </div>
                            </div><!-- /.col-lg-6 -->
                            <div class="col-lg-6">

                                <p class="setting_description">
                                    The movement of the motor between the steps.
                                </p>
                                <div class="input-group" id="move_degrees">
                                    <span class="input-group-addon">move_degrees</span>
                                    <input type="number" class="form-control" />
                                    <span class="input-group-addon">deg</span>
                                    <span class="input-group-btn">
                                        <button class="btn btn-default" type="button" id="stack_control_move_left"><span class="glyphicon glyphicon-arrow-left"></span></button>
                                        <button class="btn btn-default" type="button" id="stack_control_move_right"><span class="glyphicon glyphicon-arrow-right"></span></button>
                                    </span>
                                </div>
                            </div><!-- /.col-lg-6 -->
                        </div><!-- /.row -->
                        <div>&nbsp;</div>
                        <div class="row">
                            <div class="col-lg-6">
                                <p class="setting_description">
                                    The delay before a photo such that vibrations are damped.
                                </p>
                                <div class="input-group"  id="stack_delay_before_photo">
                                    <span class="input-group-addon">delay_before_photo</span>
                                    <input type="number" class="form-control" min="0" />
                                    <span class="input-group-addon">ms</span>
                                </div>
                            </div><!-- /.col-lg-6 -->
                            <div class="col-lg-6">
                                <p class="setting_description">
                                    The delay after a photo before the motor moves.
                                </p>

                                <div class="input-group" id="stack_delay_after_photo">
                                    <span class="input-group-addon">stack_delay_after_photo</span>
                                    <input type="number" class="form-control" min="0" />
                                    <span class="input-group-addon">ms</span>
                                </div>
                            </div><!-- /.col-lg-6 -->
                        </div><!-- /.row -->
                </div>
            </div>
        </div>



        <div class="panel panel-default">
            <div class="panel-heading">Status and actions</div>
            <div class="panel-body">
                <div>
                    <div class="row">
                        <div class="col-lg-6">

                                <h4 id="status_operation">Stacking: 5/15</h4>

                        </div><!-- /.col-lg-6 -->
                        <div class="col-lg-6">
                                <h4 id="status_action" class="setting_description">Stacking: 5/15</h4>

                        </div><!-- /.col-lg-6 -->
                    </div><!-- /.row -->
                    <div class="progress">
                        <div class="progress-bar progress-bar-striped active" id="status_progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                            <span class="sr-only">45% Complete</span>
                        </div>
                    </div>


                </div>



                <div class="row">
                    <div class="col-lg-6">
                        <div class="input-group" style="width:100%">
                            <button class="btn btn-default btn-block" role="button" id="start_stacking"><span class="glyphicon glyphicon-play"></span> Start</button>
                        </div>
                    </div><!-- /.col-lg-6 -->
                    <div class="col-lg-6">
                        <div class="input-group" style="width:100%">
                            <button class="btn btn-default btn-block" role="button" id="stop_stacking"><span class="glyphicon glyphicon-stop"></span> Stop</button>
                        </div>
                    </div><!-- /.col-lg-6 -->
                </div><!-- /.row -->

            </div>
        </div>



    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="dependencies/jquery-2.2.2.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="dependencies/bootstrap-3.3.6-dist/js/bootstrap.min.js"></script>
    <script src="stack.js"></script>
    <script src="main.js"></script>
  </body>
</html>